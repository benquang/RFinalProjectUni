---
title: ''
output: html_document
date: "2022-10-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{=html}
<h1 style="text-align:center">
<b>Project nhóm 2</b>
</h1>
```
```{r,include=FALSE}
library(tidyverse)
library(knitr)
```

# **Danh sách thành viên:**

```{r,echo=FALSE}
DSThanhVien <-data.frame("STT" = c(9,10,30),
                         "Name" = c("Nguyễn Trí Dũng","Lê Minh Đăng","Nguyễn Khoa Quang Thắng"),
                         "MSSV"=c("20133029","20133034","20133090"),
                         stringsAsFactors = FALSE
)

kable(DSThanhVien)
```

# Phần 1: Giới thiệu:

Điện thoại - Vật dụng không thể thiếu trong cuộc sống hiện nay khi mà toàn cầu đang tiến tới công nghệ hóa mọi thứ trong cuộc sống. Với những chức năng đa dạng và ngày càng hiện đại (như soạn văn bản Word, xem phim với độ phân giải cao,...), cộng thêm những chiếc điện thoại ngày nay có khả năng được những thiết bị khác (như máy ảnh, máy nhắn tin, máy ghi âm,...) thì việc càng nhiều người chọn điện thoại là vật bất ly thân là không thể chối cãi.

Nhận thấy điều đó, nhóm 2 nhận thức được rằng việc người mua hàng lựa chọn cấu hình và giá cả khi mua điện thoại luôn được người tiêu dùng đặt lên hàng đầu. Do vậy, để hiểu rõ hơn về sự ảnh hưởng của những chức năng, cấu hình điện thoại tới giá cả, nhóm 2 chọn đề tài là: "Phân tích mô hình dự đoán giá điện thoại qua cấu hình máy".

Và trong đề tài này, dataset được nhóm 2 thống nhất sử dụng có tên là **Mobile Phone Specifications and Prices** được tải xuống từ Kaggle và tác giả của dataset là **PRATIK** **GARAI.** Theo tác giả, dataset được lấy từ website Gadgets360 - là một trang báo của Ấn Độ được cập nhật các thông tin trên toàn thế giới, dữ liệu từ trang này được scrapped và cleaned bằng cách dùng [code ở đây](https://github.com/PratikGarai/Web-Scrapers/blob/master/BeautifulSoup/Ndtv_Scraper.py) và preprocessed [ở đây](https://github.com/PratikGarai/Mobile-Phone-Dataset-Analysis/blob/master/Additional/ndtv_analysis.ipynb)

![](https://c.ndtvimg.com/gws/739/assets/4.svg?1597035633){width="515"}

```{=html}
<h1 style="font-size: 20px">
<h1>
```
Đọc dữ liệu từ file data.csv

```{r}
data<-read.csv("./data.csv")
```

Chuyển đổi Rupee (đơn vị tiền tệ của Ấn Độ) sang Dollar Mỹ

```{r}
data['Price'] = data['Price']*0.012
```

```{r}

glimpse(data)

```

```{r}
colnames(data)[5]<-'Battery'
colnames(data)[6]<-'Screensize'
colnames(data)[10]<-'NumOfProcessor'
colnames(data)[11]<-'Ram'
colnames(data)[12]<-'InternalStorage'
colnames(data)[13]<-'RearCamera'
colnames(data)[14]<-'FrontCamera'
colnames(data)[15]<-'OS'
colnames(data)[16]<-'Wifi'
colnames(data)[19]<-'NumOfSims'
colnames(data)[20]<-'3G'
colnames(data)[21]<-'4G'


colnames(data)
```

```{r}
any(is.na(data[1:1359,]))

```

# Phần 2: Mô hình hoá dữ liệu

# Phần 3: Kiểm định giả thuyết

## [***Biến phân loại:***]{.underline}

### **Brand**

```{r}
new_data<-data
new_data<-new_data[order(new_data$Brand),]
new_brand = as.factor(new_data$Brand)
new_price = new_data$Price
new_brand<-as.numeric(new_brand)
summary(aov(new_price~new_brand))
```

### Model

```{r}
new_data<-data
new_data<-new_data[order(new_data$Model),]
new_model <- as.factor(new_data$Model)
new_price = new_data$Price
new_model<-as.numeric(new_model)
anova_model<-aov(new_model~new_price)
summary(anova_model)
```

### Touchscreen

```{r}
new_data<-data
new_data[new_data$Touchscreen == "Yes",]['Touchscreen']<-as.integer(1)
new_data[new_data$Touchscreen == "No",]['Touchscreen']<-as.integer(0)
new_data$Touchscreen<-as.numeric(new_data$Touchscreen)
cor.test(new_data$Price,new_data$Touchscreen)
```

### Operating System

```{r}
new_data<-data
new_data<-new_data[order(new_data$OS),]
new_OS = as.numeric(as.factor(new_data$OS))
new_price = new_data$Price
summary(aov(new_OS~new_price))
```

### GPS:

```{r}
new_data<-data
new_data[new_data$GPS == "Yes",]['GPS']<-as.integer(1)
new_data[new_data$GPS == "No",]['GPS']<-as.integer(0)
new_data$GPS<-as.numeric(new_data$GPS)
cor.test(new_data$Price,new_data$GPS)
```

### 3G

```{r}
new_data<-data
new_data[new_data$`3G` == "Yes",]['3G']<-as.integer(1)
new_data[new_data$`3G` == "No",]['3G']<-as.integer(0)
new_data$`3G`<-as.numeric(new_data$`3G`)
cor.test(new_data$Price,new_data$`3G`)
```

### 4G

```{r}
new_data<-data
new_data[new_data$`4G` == "Yes",]['4G']<-as.integer(1)
new_data[new_data$`4G` == "No",]['4G']<-as.integer(0)
new_data$`4G`<-as.numeric(new_data$`4G`)
cor.test(new_data$Price,new_data$`4G`)
```

## [*Biến liên tục:*]{.underline}

### Battery Capacity

```{r}
result<-cor.test(data$Price,data$Battery,method = 'pearson')
print(result)
```

### Screensize

```{r}
result<-cor.test(data$Price,data$Screensize,method = 'pearson')
print(result)
```

### Resolution.x

```{r}
result<-cor.test(data$Price,data$Resolution.x,method = 'pearson')
print(result)

```

### Resolution.y

```{r}
result<-cor.test(data$Price,data$Resolution.y,method = 'pearson')
print(result)
```

### NumOfProcessor

```{r}
result<-cor.test(data$Price,data$NumOfProcessor,method = 'pearson')
print(result)
```

### RAM

```{r}
result<-cor.test(data$Price,data$Ram,method = 'pearson')
print(result)
```

### Internal storage

```{r}
result<-cor.test(data$InternalStorage,data$Price,method = 'pearson')
print(result)
```

### Rear Camera

```{r}
result<-cor.test(data$RearCamera,data$Price,method = 'pearson')
print(result)
```

### Front camera

```{r}
result<-cor.test(data$FrontCamera,data$Price,method = 'pearson')
print(result)
```

### NumOfSims

```{r}
result<-cor.test(data$Price,data$NumOfSims)
print(result)
```

Wifi và Bluetooth:

Do mẫu điện thoại không có wifi và bluetooth quá ít nên không thể thống kê

# Phần 4: Mô hình hoá dữ liệu

Chỉnh sửa lại data để phù hợp với hàm tuyến tính:

```{r}
new_data<-data
new_data$Model<-as.numeric(as.factor(new_data$Model))

new_data[new_data$Touchscreen == "Yes",]$Touchscreen<-as.integer(1)
new_data[new_data$Touchscreen == "No",]$Touchscreen<-as.integer(0)
new_data$Touchscreen<-as.numeric(new_data$Touchscreen)

new_data$OS = as.numeric(as.factor(new_data$OS))

new_data[new_data$Bluetooth == "Yes",]['Bluetooth']<-as.integer(1)
new_data[new_data$Bluetooth == "No",]['Bluetooth']<-as.integer(0)
new_data$Bluetooth<-as.numeric(new_data$Bluetooth)

new_data[new_data$Wifi == "Yes",]['Wifi']<-as.integer(1)
new_data[new_data$Wifi == "No",]['Wifi']<-as.integer(0)
new_data$Wifi<-as.numeric(new_data$Wifi)

new_data[new_data$GPS == "Yes",]['GPS']<-as.integer(1)
new_data[new_data$GPS == "No",]['GPS']<-as.integer(0)
new_data$GPS<-as.numeric(new_data$GPS)

new_data[new_data$`3G` == "Yes",]['3G']<-as.integer(1)
new_data[new_data$`3G` == "No",]['3G']<-as.integer(0)
new_data$`3G`<-as.numeric(new_data$`3G`)

new_data[new_data$`4G` == "Yes",]['4G']<-as.integer(1)
new_data[new_data$`4G` == "No",]['4G']<-as.integer(0)
new_data$`4G`<-as.numeric(new_data$`4G`)

head(new_data,10)
```

```{r}
brand<-unique(data[order(data$Brand),]$Brand)
numOfPhone<-c()

for (i in 1:length(brand))
{
  numOfPhone<-append(numOfPhone,nrow(filter(data,data$Brand ==brand[i])))
}

brand_numOfPhone <-data.frame(brand,numOfPhone)
brand_numOfPhone<-brand_numOfPhone%>%filter(numOfPhone>=18)
brand_numOfPhone[1:nrow(brand_numOfPhone),1]

new_data<-new_data %>% filter(new_data$Brand%in%brand_numOfPhone$brand)
new_data<-new_data[order(new_data$Brand),]

```

```{r}

OStoNum<-data.frame(OS = unique(data[order(data$OS),]$OS))
OStoNum$Num<-c(1:nrow(OStoNum))
OStoNum
```

```{r}
glimpse(new_data)
head(new_data)
```

```{r}
test_data<-read.csv('./test_data.csv')
colnames(test_data)[5]<-'Battery'
colnames(test_data)[6]<-'Screensize'
colnames(test_data)[10]<-'NumOfProcessor'
colnames(test_data)[11]<-'Ram'
colnames(test_data)[12]<-'InternalStorage'
colnames(test_data)[13]<-'RearCamera'
colnames(test_data)[14]<-'FrontCamera'
colnames(test_data)[15]<-'OS'
colnames(test_data)[16]<-'Wifi'
colnames(test_data)[19]<-'NumOfSims'
colnames(test_data)[20]<-'3G'
colnames(test_data)[21]<-'4G'
test_data[test_data$Touchscreen == "Yes",]$Touchscreen<-as.integer(1)
#test_data[test_data$Touchscreen == "No",]$Touchscreen<-as.integer(0)
test_data$Touchscreen<-as.numeric(test_data$Touchscreen)

for (i in 1:nrow(test_data))
{
    for (j in 1:nrow(OStoNum))
    {
      if (test_data[i,]$OS==OStoNum[j,]$OS)
      {
        test_data[i,]$OS = OStoNum[j,]$Num
      }
    }
}
test_data$OS<-as.numeric(test_data$OS)
test_data[test_data$Bluetooth == "Yes",]['Bluetooth']<-as.integer(1)
#test_data[test_data$Bluetooth == "No",]['Bluetooth']<-as.integer(0)
test_data$Bluetooth<-as.numeric(test_data$Bluetooth)

test_data[test_data$Wifi == "Yes",]['Wifi']<-as.integer(1)
#test_data[test_data$Wifi == "No",]['Wifi']<-as.integer(0)
test_data$Wifi<-as.numeric(test_data$Wifi)

test_data[test_data$GPS == "Yes",]['GPS']<-as.integer(1)
#test_data[test_data$GPS == "No",]['GPS']<-as.integer(0)
test_data$GPS<-as.numeric(test_data$GPS)

test_data[test_data$`3G` == "Yes",]['3G']<-as.integer(1)
#test_data[test_data$`3G` == "No",]['3G']<-as.integer(0)
test_data$`3G`<-as.numeric(test_data$`3G`)

test_data[test_data$`4G` == "Yes",]['4G']<-as.integer(1)
#test_data[test_data$`4G` == "No",]['4G']<-as.integer(0)
test_data$`4G`<-as.numeric(test_data$`4G`)

head(test_data,10)
```

**Mô hình dự đoán giá điện thoại cho tất cả điện thoại**

```{r}
regression_data<-new_data
regression_data$Brand<-as.numeric(as.factor(regression_data$Brand))
regression<-lm(regression_data$Price ~
     regression_data$Brand+
     regression_data$Battery+
     regression_data$Screensize+
     regression_data$Touchscreen+
     regression_data$Resolution.x+
     regression_data$Resolution.y+
     regression_data$NumOfProcessor+
     regression_data$Ram+
     regression_data$InternalStorage+
     regression_data$RearCamera+
     regression_data$FrontCamera+
     regression_data$OS+
     regression_data$Wifi+
     regression_data$Bluetooth+
     regression_data$GPS+
     regression_data$NumOfSims+
     regression_data$`3G`+
     regression_data$`4G`
   ,data = regression_data)
summary(regression)

```

```{r}
regression_data<-test_data
regression_data$Brand<-as.numeric(as.factor(regression_data$Brand))
PredictedPrice = predict(regression,regression_data)
oneForAll<-regression_data%>%mutate(PredictedPrice = predict(regression,regression_data))
oneForAll<-oneForAll%>%mutate(error= PredictedPrice-Price,sq.error = error^2)
oneForAll<-oneForAll[c('Name','Price','PredictedPrice','error','sq.error')]
oneForAll
mse<-mean(oneForAll$sq.error)
rmse<-sqrt(mse)
rmse
```

**Mô hình tuyến tính cho mỗi hãng mà hãng đó có số thiết bị lớn hơn hoặc bằng 6:**

```{r,echo=TRUE,include=FALSE}
for (x in brand_numOfPhone$brand)
{
  print(x)
  temp_data<-new_data %>% filter(new_data$Brand == x)
  regression<-lm(temp_data$Price ~
     temp_data$Battery+
     temp_data$Screensize+
     temp_data$Touchscreen+
     temp_data$Resolution.x+
     temp_data$Resolution.y+
     temp_data$NumOfProcessor+
     temp_data$Ram+
     temp_data$InternalStorage+
     temp_data$RearCamera+
     temp_data$FrontCamera+
     temp_data$OS+
     temp_data$Wifi+
     temp_data$Bluetooth+
     temp_data$GPS+
     temp_data$NumOfSims+
     temp_data$`3G`+
     temp_data$`4G`
   ,data = temp_data)
    print(summary(regression))
    print(cat('\n\n\n\n'))
}
```

Dự đoán giá laptop:

```{r}
```

Dự đoán giá dựa trên 25 model:

```{r}
fn_RegressionBasedOnBrand<-function(test_data,new_data){
  #Sắp xếp lại theo Brand
  test_data<-test_data[order(test_data$Brand),]
  #result lưu trữ giá dự đoán
  result<-data.frame(Name = test_data$Name,
                     Price = test_data$Price,
                     PredictedPrice=NA)
  #lặp từng dòng
  for (i in 1:nrow(test_data))
  {
    #Kiểm tra điều kiện
    if (!test_data[i,]$Brand %in% new_data$Brand)
    {
      print(paste("Brand",test_data[i,]$Brand, "không tồn tại trong database!"))
      next
    }
    else if (!test_data[i,]$OS %in% new_data$OS)
    {
      print(paste("OS không tồn tại trong database!"))
      next
    }
    #Tạo model cho Brand ở hiện tại
    regression_data<-new_data[new_data$Brand == test_data[i,]$Brand,]
    regression<-lm(regression_data$Price ~
     regression_data$Battery+
     regression_data$Screensize+
     regression_data$Touchscreen+
     regression_data$Resolution.x+
     regression_data$Resolution.y+
     regression_data$NumOfProcessor+
     regression_data$Ram+
     regression_data$InternalStorage+
     regression_data$RearCamera+
     regression_data$FrontCamera+
     regression_data$OS+
     regression_data$Wifi+
     regression_data$Bluetooth+
     regression_data$GPS+
     regression_data$NumOfSims+
     regression_data$`3G`+
     regression_data$`4G`
   ,data = regression_data)
    regression_data<-test_data[i,]
    #Đoán giá ở dòng hiện tại
    result[i,]$PredictedPrice <- predict(regression,regression_data)
  } 
  return(result)
}
suppressWarnings({
  modelForeachBrand<-fn_RegressionBasedOnBrand(test_data,new_data)
})
modelForeachBrand<-modelForeachBrand%>%
  mutate(error= PredictedPrice-Price,sq.error = error^2)
print(modelForeachBrand)
mse_ForeachBrand<-mean(na.omit(modelForeachBrand$sq.error))
rmse_ForeachBrand<-sqrt(mse_ForeachBrand)
rmse_ForeachBrand

```

```{r}
#regression_train<-regression_train%>%
#                    mutate(error= PredictedPrice-Price,sq.error = error^2)
#regression_train[c('Name','Price','PredictedPrice','error','sq.error')]
#mse<-mean(regression_train$sq.error)
#rmse<-sqrt(mse)
#rmse
```
